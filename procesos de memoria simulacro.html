<!doctype html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<title>Procesos de Memoria</title>
	<link rel="stylesheet" href="./css/style.css">
</head>
<body>
	<div class="contenedor">
		<h2 class="titulo"></h2>

		<div class="derecha">
			<h3>Letras</h3>
			<div class="letras">
				<div class="letra a">A</div>
				<div class="letra b">B</div>
				<div class="letra c">C</div>
				<div class="letra d">D</div>
			</div>
			
			<h3>Numeros</h3>
			<div class="numeros">
				<div class="numero">1</div>
				<div class="numero">2</div>
				<div class="numero">3</div>
				<div class="numero">4</div>
			</div>

			<div class="matarpro">
				<select name="select" id="select"></select>
				<button>mata</button>
			</div>
		</div>

		<div class="centro">
			<h3>Ejecución</h3>
			<div id="ejecucion"></div>
			<h3>Espera</h3>
			<div id="espera"></div>
		</div>

		<div class="izquierda">
			<h3>Simulación</h3>
			<div class="memoria">
				<div></div>
				<div></div>
				<div></div>
				<div></div>
				<div></div>
				<div></div>
				<div></div>
				<div></div>
				<div></div>
				<div></div>
			</div>
		</div>
	</div>
	<script src="./bower_components/jquery/dist/jquery.js" type="text/javascript"></script>
	<script>

		var proceso = {
			letra    : '',
			color    : '',
			espacio  : 0,
			restaurar: function(){
				this.letra   = '';
				this.color   = '';
				this.espacio = 0
			},
			cargaLetraColor: function(elemento){
				this.letra   = elemento.text();
				this.color   = elemento.css('color');
				elemento.remove();
			},
			obtener: function(){
				return {
					letra  : this.letra,
					color  : this.color,
					espacio: this.espacio
				};
			}
		};

		var memoria = {
			$elementoM: {},
			$elementoC: {},
			tamaño    : 10,
			procesos  : [],
			_enEspera : [],
			_utilizada: function(){
				var total = 0;
				for (var i = 0; i < this.procesos.length; i++) {
					total += this.procesos[i].espacio;
				}
				return total;
			},
			_añadirProceso: function(proceso){
				this.procesos.push(proceso);
				this._pintarM(proceso.espacio, proceso.color);
			},
			_añadirEspera: function(proceso){
				this._enEspera.push(proceso);
				this._pintarC(proceso);
			},
			cargarElementoMemoria:function(elemento){
				this.$elementoM = elemento;
			},
			cargarElementoCache:function(elemento){
				this.$elementoC = elemento;
			},
			asignar: function(proceso){
				if(this._restante() < proceso.espacio){
					this._añadirEspera(proceso);
				}else{
					this._añadirProceso(proceso);
				}
			},
			_pintarM: function(cantidad, color){
				for (var i = cantidad-1; i >= 0; i--) {
					this.$elementoM.eq(this._restante() + i).css({
						'background': color,
						'border'    :'1px solid white'
					});
				}
			},
			_pintarC: function(proceso){
				var l = [];
				for (var i in proceso) {
					l.push(i + ':' + proceso[i]);
				}
					this.$elementoC.html(l.join(', '));
			},
			_restante: function(){
				return this.tamaño - this._utilizada();
			}
		};

		/* se ejecuta hasta que carga el Dom */
		$(document).ready(function(){
			var _uno    = 1;
			var _dos    = 2;
			var _tres   = 3;
			
			var titulos = [ 'Selecione una letra', 'Ahora seleciona un numero', '¡Ya tienes una letra! Por favor intenta con un numero '];
			
			var $titulo  = $('.titulo');
			var $letras  = $('.letra');
			var $numeros = $('.numero');

			memoria.cargarElementoMemoria($('.memoria > div'));
			memoria.cargarElementoCache($('#espera'));

			$titulo.text(titulos[_uno-_uno]);
			
			// click sobre alguna letra
			$letras.on('click', function(e){	
				if(proceso.letra === ''){
					proceso.cargaLetraColor($(e.target)); 
					$titulo.text(titulos[_dos-_uno]);		
				}else{
					$titulo.text(titulos[_tres-_uno]);		
				}
			});

			// click sobre algun numero
			$numeros.on('click', function(e){
				proceso.espacio = parseInt($(e.target).text());
				$titulo.text(titulos[_uno-_uno]);

				memoria.asignar(proceso.obtener());

				proceso.restaurar();
			});

		});
	</script>
</body>
</html>